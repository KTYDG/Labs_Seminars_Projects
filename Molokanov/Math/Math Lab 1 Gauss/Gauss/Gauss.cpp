#include <iostream>
#include <iomanip>
#include <vector>
#include <windows.h>
using namespace std;
enum ConsoleColor { // Цвета
	Black = 0,
	Green = 2,
	Cyan = 3,
	Red = 4,
	Yellow = 6,
	White = 15
};
void SetColor(ConsoleColor bg, ConsoleColor tx) { //задает цвет
	HANDLE hC = GetStdHandle(STD_OUTPUT_HANDLE);
	SetConsoleTextAttribute(hC, (WORD)((bg << 4) | tx));
}

void PrintMatrix(vector<vector<double>> A, int n) { // Вывод всей матрицы
	cout << fixed; cout.precision(4);
	for(int i = 0; i < n + 1; i++) {
		for(int j = 0; j < n; j++) {
			if(i == 0) { //вывод порядка столбцов
				SetColor(Black, Yellow);
				cout << setw(10) << j + 1;
				if(j == n - 1) cout << setw(11) << "b";
				SetColor(Black, White);
				continue;
			}
			if(i > 0 and j == 0) { //вывод порядка строк
				SetColor(Black, Yellow);
				cout << setw(3) << i;
				SetColor(Black, White);
			}
			if(i > 0) {
				if(A[i - 1][j] == 0 and i - 1 > j) SetColor(Black, Green);
				else if(i - 1 == j and A[i - 1][j] != 1) SetColor(Black, Red);
				else if(i - 1 == j) SetColor(Black, Cyan);
				if(A[i - 1][j] == 0)  A[i - 1][j] = abs(A[i - 1][j]);
				cout << setw(10) << A[i - 1][j]; //вывод белым остальные числа
				SetColor(Black, White);
			}
			if(j == n - 1) cout << " | " << left << setw(10) << A[i - 1][j + 1] << right;
		}
		cout << "\n\n";
	}
}

void GetX(vector<double>Y) { // Для вывода коэффициентов
	cout << "\n\nНеизвестные:\n";
	SetColor(Black, Yellow);
	for(int i = 0; i < Y.size(); i++) {
		cout << setw(10) << i + 1;
	}
	SetColor(Black, White);
	cout << "\n\n";
	for(int i = 0; i < Y.size(); i++) {
		cout << setw(10) << Y[i];
	}
	cout << "\n\n";
}



int main() {
	setlocale(LC_ALL, "Rus");
	int n = 15; // РАЗМЕРНОСТЬ МАТРИЦЫ
	bool b;
	vector<vector<double>> A(n, vector<double>(n + 1));
	//A = {
	//	{-0.4000,	0.0800,-0.10666, 0.0000, 0.0000,	0.0000, 0.0000, 0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.2598},
	//	{ 0.0000,	0.0000, 0.0000,-0.4000, 0.0800,-0.10666, 0.0000, 0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.1862},
	//	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.4000,	0.0800,-0.10666,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//	{ 0.0000,	0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.4000,	0.0800,-0.10666,	0.0000,	0.0000,	0.0000,	0.1862},
	//	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.4000,	0.0800,-0.10666,	0.2598},
	//	{ 1.0000,	0.0000,	0.0000,-1.0000, 0.4000,-0.0800,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//	{ 0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,-0.0800,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,-0.0800,	0.0000,	0.0000,	0.0000,	0.0000},
	//	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,-0.0800,	0.0000},
	//	{ 0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//	{ 0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,	0.0000,	0.0000,	0.0000,	0.0000},
	//	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,	0.0000},
	//	{ 0.0000,	1.0000,-0.4000, 0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000}
	//};
	A = {
	{-0.4000,	0.1600,-0.064, 0.0000, 0.0000,	0.0000, 0.0000, 0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.2598},
	{ 0.0000,	0.0000, 0.0000,-0.4000,	0.1600,-0.064, 0.0000, 0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.1862},
	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.4000,	0.1600,-0.064,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	{ 0.0000,	0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.4000,	0.1600,-0.064,	0.0000,	0.0000,	0.0000,	0.1862},
	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.4000,	0.1600,-0.064,	0.2598},
	{ 1.0000,	0.0000,	0.0000,-1.0000, 0.8000,-0.4800,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	{ 0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.8000,-0.4800,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000, 0.8000,-0.4800,	0.0000,	0.0000,	0.0000,	0.0000},
	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.8000,-0.4800,	0.0000},
	{ 0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	1.2000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	{ 0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	1.2000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	1.2000,	0.0000,	0.0000,	0.0000,	0.0000},
	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	1.2000,	0.0000},
	{ 0.0000,	1.0000,-1.2000, 0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000}
	};

	//A = {
	//{-0.4000,	0.0800,-0.107, 0.0000, 0.0000,	0.0000, 0.0000, 0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.168},
	//{ 0.0000,	0.0000, 0.0000,-0.4000, 0.0800,-0.107, 0.0000, 0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.126},
	//{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.4000,	0.0800,-0.107,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.1},
	//{ 0.0000,	0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.4000,	0.0800,-0.107,	0.0000,	0.0000,	0.0000,	-0.084},
	//{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,-0.4000,	0.0800,-0.107,	-0.071},
	//{ 1.0000,	0.0000,	0.0000,-1.0000, 0.4000,-0.0800,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//{ 0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,-0.0800,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,-0.0800,	0.0000,	0.0000,	0.0000,	0.0000},
	//{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,-0.0800,	0.0000},
	//{ 0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//{ 0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,	0.0000,	0.0000,	0.0000,	0.0000},
	//{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000,-1.0000,	0.4000,	0.0000},
	//{ 0.0000,	1.0000,-0.4000, 0.0000, 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000},
	//{ 0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	0.0000,	1.0000,	0.0000,	0.0000}
	//};

	PrintMatrix(A, n);
	// Прямой ход Гаусса
	double diag, line, max;
	for(int i = 0; i < n; i++) {
		diag = A[i][i];
		max = i;
		for(int d = i + 1; d < n; d++) {
			if(abs(diag) <= abs(A[d][i])) { diag = A[d][i]; max = d; }
		}
		swap(A[i], A[max]);
		for(int j = 0; j < n + 1; j++) { // Приводим число на диагонали к единице
			A[i][j] /= diag;
		}
		//cout << i + 1 << ") К ЕДИНИЦE\n"; PrintMatrix(A, n); // Показываем главаная диагональ пришла к 1
		for(int it = i + 1; it < n; it++) { // Вычитаем из строк
			line = A[it][i]; // Запоминаем число строки под главной диагональю
			for(int j = 0; j < n + 1; j++) {
				A[it][j] -= line * A[i][j];
			}
		}
		if(i > 13) { cout << "\n"; PrintMatrix(A, n); } // Показываем как занулили строки под текущим столбцом
	}
	// Обратный ход Гаусса
	vector<double>B(n);
	for(int i = n - 1; i >= 0; i--) {
		for(int j = n - 1; j >= 0; j--) {
			A[i][n] -= B[j] * A[i][j];
		}
		B[i] = (A[i][n]);
	}
	GetX(B); // Вывод коэффициентов
	return 0;
}